---
title: "Analysis of Pierce County House Sales"
author: "Henry Shaw & Saransh Rakshak"
date: "Due: September 24rd, 2024"
output: html_document
---

```{R setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(ggpubr)
library(knitr)
library(scales)

# Reading in data
housing <- read.csv("pierce_co_house_sales.csv")

housing$sale_date <- as.Date(housing$sale_date)
housing$decade_built <- housing$year_built - (housing$year_built %% 10)
housing$sq_ft_thousand <- round(housing$house_square_feet / 1000, digits = 1)
housing$has_view_quality <- ifelse(housing$view_quality == "", 0, 1)
housing$has_waterfront <- ifelse(housing$waterfront_type == "", 0, 1)
```


```{R, echo=FALSE}
glimpse(housing)
```

Write a short report that describes associations between sale price and other variables.
You should use methods learned in Weeks 0-2 of the course.

<br>

## Part 1: 

Can sales price be predicted? Choose any three variables other than sale price.
For each variable, explore its association with sale price using plots, tables, and summary statistics. 
Include at least one plot or table for each variable. Report appropriate statistics for each variable. 
Summarize your findings in 2-3 sentences for each variable.

In your analysis, pay attention to outliers, missing
values, and excessive zeros. In both questions, include in the text a short description of any
of these features and describe the impact that they may have on your analysis.


```{R, echo=FALSE}
# Select columns for correlation analysis
vars <- housing %>% select(sale_price, house_square_feet, sq_ft_thousand, year_built, decade_built, bedrooms)

# Calculate correlation matrix
cor_matrix <- cor(vars, use = "complete.obs")

# Print correlation with sale_price
cor_price <- cor_matrix["sale_price", ]

# Convert to data frame for kable
cor_price_df <- as.data.frame(t(cor_price))
colnames(cor_price_df) <- colnames(cor_matrix)  # Set column names
rownames(cor_price_df) <- "Correlation"

# Display with kable
kable(cor_price_df, 
      caption = "Correlation of Variables with Sale Price",
      col.names = colnames(cor_price_df),
      align = "c", 
      format = "markdown")
```



<br>

- First, we will analyze House square footage, the variable with the highest correlation (=0.54) to 'sale_price'.

```{R, echo=FALSE}
# Summary statistics for square feet
sq_ft_summary <- housing %>%
group_by(sq_ft_thousand) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for House Square Feet
kable(sq_ft_summary, 
  col.names = c("House Square Feet (in thousands)", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "{A1} Summary Statistics for Sale Price by House Square Feet",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for square feet
ggplot(data = sq_ft_summary, aes(x=sq_ft_thousand, y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  labs(
    title = "{A2} Mean Sales Price by House Square Feet",
    x = "Square Feet (in thousands)",
    y = "Sale Price ($USD)"
  ) +
  geom_text(aes(label=mean_sale_price), vjust=0.1, size=1.5, angle = 90) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of house square feet
ggplot(housing, aes(x = factor(sq_ft_thousand), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  labs(
    title = "{A3} Sale Price Distribution by Square Footage",
    x = "Square Feet (in thousands)",
    y = "Sale Price ($USD)"
  ) +
  scale_y_continuous(labels = scales::comma)

# Scatter plot with regression line for house square feet
ggscatter(housing, x = "house_square_feet", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  labs(
    title = "{A4} Sale Price Correlation with House Square Feet",
    x = "Square Feet",
    y = "Sale Price ($USD)"
  ) +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```

- From our graph {A4}, we can see that sale price is highly correlated to house square feet (R = 0.54). We can also observe from our graph in {A3} that sale price does not have a large range of distribution for 0.6 thousand square feet to 4.2 thousand square feet. This is because there are a greater count of instances (house sales) between that range. This is also where the majority of our data (count of house sales) lies. As a result, we can conclude that house square feet does have a  general association to sale price, with sale price growing as house square feet increases as reflected in {A4}. 

- Outliers can be seen in the mean distribution in Graph {A2} and it's specific value can be found using Table {A1} at 6.0 thousand square feet. This outlier is based on a single point (i.e. a single house sale), whose mean sale price of 6090000 is far greater than those with slightly greater or less house square feet. The exact reasoning for this outlier cannot be deducted from the information at hand, however, we can predict this sale was a special situation where the house may be located geographically in a high value area or the house could be furnished with modern amenities, or some other reason that increases its value far greater than expected. The presence of this outlier reduces our regression score (R = 0.54) and thus reduces association between house square feet and sale price, however since this is a single point it is reasonable to remove this data point from our set. We can also observe that there is an outlier for 0.5 thousand square feet. This is reflected in our table {A1} where our SD for house square feet at 0.5 thousand is 989258, much greater than other bins.However, unlike our outlier at 6.0 thousand square feet, the outlier at 0.5 thousand square feet has 37 other values in its bin, thus it does not as greatly affect our overall association between house square feet and sale price. 


<br>

- Next, we will view the association between the time the house was built and Sale Price.

```{R, echo=FALSE}
# Summary statistics for Year Built
year_built_summary <- housing %>%
group_by(decade_built) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Decade built
kable(year_built_summary, 
  col.names = c("Decade Built", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "{B1} Summary Statistics for Sale Price by Decade Built",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for decade built
ggplot(data = year_built_summary, aes(x=factor(decade_built), y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  labs(
    title = "{B2} Mean Sales Price by Decade Built",
    x = "Decade Built",
    y = "Sale Price ($USD)"
  ) +
  geom_text(aes(label=mean_sale_price), vjust=0.1, size=2.5, angle = 90) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of decade built
ggplot(housing, aes(x = factor(decade_built), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  labs(
    title = "{B3} Sale Price Distribution by Decade Built", 
    x = "Decade Built",
    y = "Sale Price ($USD)"
  ) +
  scale_y_continuous(labels = scales::comma)

# Scatter plot with regression line for year built
ggscatter(housing, x = "year_built", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  labs(
    title = "{B4} Sale Price Correlation with Year Built",
    x = "Year Built",
    y = "Sale Price ($USD)"
  ) +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```

- From our graph in {B4} we can conclude that year built has a slight association with sale price based on its regression (R = 0.23).

- Outliers can also be deducted from our graphs. From graph {B2} we can see that sale price for houses built in the decade of 1880 have a higher sale price; however we can see from our table {B1} that this decade only has one data point. Thus, we can disregard this point as it is likely that the house built in 1880 is a special case, and could have factors such as location and historical value influencing its sale price to be higher than its expected value. From our distribution graph {B3}, we can see that the decades 1990 and 2010 both have a single house sale price of over 6 million that is much greater than the decade's sale price mean. Again, these individual house sales can be regarded as special cases, such as custom built houses or houses located in a higher value location. However, as our bins of 1990 and 2010 have a greater count of data values, these outliers do not as greatly impact our association between Decade built and sale price, unlike our data point for 1880s.



<br>

- Lastly, we will view the association between Number of Bedrooms and Sale Price. Let us find the summary statistics for Bedrooms in relation to Sale Price.

```{R, echo = FALSE}
# Summary statistics for Bedrooms
bedroom_summary <- housing %>%
group_by(bedrooms) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Bedrooms
kable(bedroom_summary, 
  col.names = c("Bedrooms", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "{C1} Summary Statistics for Sale Price by Number of Bedrooms",
  align = "c")

```


```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for bedrooms
ggplot(data = bedroom_summary, aes(x = factor(bedrooms), y = mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  labs(
    title = "{C2} Mean Sale Price by Number of Rooms",
    x = "Number of Bedrooms",
    y = "Sale Price ($USD)"
  ) +
  geom_text(aes(label=mean_sale_price), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of bedrooms
ggplot(housing, aes(x = factor(bedrooms), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  labs(
    title = "{C3} Sale Price Distribution by Number of Rooms",
    x = "Number of Bedrooms",
    y = "Sale Price ($USD)"
  ) +
  scale_y_continuous(labels = scales::comma)

# scatter plot for number of bedrooms with regression line
ggscatter(data = housing, x = "bedrooms", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  labs(
    title = "{C4} Sale Price Correlation with Number of Bedrooms",
    x = "Number of Bedrooms",
    y = "Sale Price ($USD)"
  ) +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```







<br>

## Part 2: 

Is missingness informative? Create a binary variable that indicates whether
the view quality is missing. Missing values in this data file are represented as an empty
character string; that is, `'. Choose three variables. (They may, but do not need to be, the
same variables from part 1.) Explore the association between these variables and the binary
variable that you created. Follow the same instructions as in Part 1.

```{R, echo=FALSE}
# Select columns for correlation analysis
vars <- housing %>% select(has_view_quality, sale_price, house_square_feet, has_waterfront)

# Calculate correlation matrix
cor_matrix <- cor(vars, use = "complete.obs")

# Print correlation with has_view_quality
cor_view <- cor_matrix["has_view_quality", ]

# Convert to data frame for kable
cor_view_df <- as.data.frame(t(cor_view))
colnames(cor_view_df) <- colnames(cor_matrix)  # Set column names
rownames(cor_view_df) <- "Correlation"

# Display with kable
kable(cor_view_df, 
      caption = "Correlation of Variables with data for View Quality",
      col.names = colnames(cor_view_df),
      align = "c", 
      format = "markdown")
```



<br>

- First, we will analyze 'sale_price', the variable with the highest correlation (=0.25) to 'has_view_quality'.

```{R, echo=FALSE}
# Summary statistics for sale_price
price_view_summary <- housing %>%
group_by(has_view_quality) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Bedrooms
kable(price_view_summary, 
  col.names = c("Has View Quality", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "{D1} Summary Statistics for Has View Quality by Sale Price",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for has_view_quality
ggplot(data = price_view_summary, aes(x=factor(has_view_quality), y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  labs(
    title = "{D2} Mean Sale Price by presence of View Quality description",
    x = "Has View Quality (0=no, 1=yes)",
    y = "Sale Price ($USD)"
  ) +
  geom_text(aes(label=mean_sale_price), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)


# Plot distribution of sale_price
ggplot(housing, aes(x = factor(has_view_quality), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  labs(
    title = "{D3} Sale Price Distribution by presence of View Quality description",
    x = "Has View Quality (0=no, 1=yes)",
    y = "Sale Price ($USD)"
  ) +
  scale_y_continuous(labels = scales::comma)

```




<br>

- Analyzing association between House square footage and presence of view quality description.

```{R, echo=FALSE}
# Summary statistics for house_square_feet
sqft_view_summary <- housing %>%
group_by(has_view_quality) %>%
summarize(
  count = n(),
  mean_sqft = as.integer(mean(house_square_feet, na.rm = TRUE)),
  median_sqft = as.integer(median(house_square_feet, na.rm = TRUE)),
  sd_sqft = as.integer(sd(house_square_feet, na.rm = TRUE)),
  min_sqft = min(house_square_feet, na.rm = TRUE),
  max_sqft = max(house_square_feet, na.rm = TRUE)
)

# Display the summary statistics in a table format for house square footage
kable(sqft_view_summary, 
  col.names = c("Has View Quality", "Count", "Mean Square Feet", "Median Square Feet", 
                "SD of Square Feet", "Min Square Feet", "Max Square Feet"),
  caption = "{E1} Summary Statistics for Has View Quality by Square Feet",
  align = "c")


```


```{R, echo=FALSE, message=FALSE}

# Bar chart for mean house_square_feet for has_view_quality
ggplot(data = sqft_view_summary, aes(x=factor(has_view_quality), y=mean_sqft)) +
  geom_bar(stat = "identity", fill="steelblue") +
  labs(
    title = "{E2} Mean Square Footage by presence of View Quality description",
    x = "Has View Quality (0=no, 1=yes)",
    y = "House Square Feet (sqft)"
  ) +
  geom_text(aes(label=mean_sqft), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)


# Plot distribution of house_square_feet
ggplot(housing, aes(x = factor(has_view_quality), y = house_square_feet)) +
  geom_boxplot(fill = "green", color = "black") +
  labs(
    title = "{E3} Square Footage Distribution by presence of View Quality description",
    x = "Has View Quality (0=no, 1=yes)",
    y = "House Square Feet (sqft)"
  ) +
  scale_y_continuous(labels = scales::comma)

```



<br>

- Analyzing association between presence of view quality description and presence of a waterfront.

```{R, echo=FALSE}

waterfront_view_freq <- housing |>
  group_by(has_view_quality) |>
  count(has_waterfront)

kable(waterfront_view_freq,
      caption = "{F1} Cross Table of Frequency for View Quality and existance of a Waterfront",
      col.names = c("Has View Quality (0=no, 1=yes)", "Has Waterfront (0=no, 1=yes)", "Frequency"))

```


```{R, echo=FALSE, message=FALSE}

ggplot(waterfront_view_freq, aes(x = has_view_quality, y = has_waterfront, size = n, color=n)) +
  geom_point() +
  geom_text(aes(label=n, hjust = c(-0.5, -0.5, 1, 1), vjust = c(-1, 1, -1, 1.5)), size=3.5) +
  labs(
    title = "{F2} Has View Quality and Has Waterfront, by frequency",
    x = "Has View Quality (0=no, 1=yes)",
    y = "Has Waterfront (0=no, 1=yes)",
    color = "Frequency",
    size = "Frequency"
  )

```

