---
title: "Analysis of Pierce County House Sales"
author: "Henry Shaw & Saransh Rakshak"
date: "Due: September 24rd, 2024"
output: html_document
---

```{R setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(ggpubr)
library(knitr)

# Reading in data
housing <- read.csv("pierce_co_house_sales.csv")

# Convert sale_date to Date type
housing$sale_date <- as.Date(housing$sale_date)

# Binning year_built by decade
housing$decade_built <- housing$year_built - (housing$year_built %% 10)

# Creating new column thousands_sq_ft 
housing$sq_ft_thousand <- round(housing$house_square_feet / 1000, digits = 1)

# Creating a new column 'has_view_quality' with 0 if sale does not have view quality, else 1
housing$has_view_quality <- ifelse(housing$view_quality == "", 0, 1)

```


```{R, echo=FALSE}

head(housing)

```

Write a short report that describes associations between sale price and other variables.
You should use methods learned in Weeks 0-2 of the course.

Part 1: 

Can sales price be predicted? Choose any three variables other than sale price.
For each variable, explore its association with sale price using plots, tables, and summary statistics. 
Include at least one plot or table for each variable. Report appropriate statistics for each variable. 
Summarize your findings in 2-3 sentences for each variable.

In your analysis, pay attention to outliers, missing
values, and excessive zeros. In both questions, include in the text a short description of any
of these features and describe the impact that they may have on your analysis.


```{R, echo=FALSE}
# Select columns for correlation analysis
vars <- housing %>% select(sale_price, house_square_feet, sq_ft_thousand, year_built, decade_built, bedrooms)

# Calculate correlation matrix
cor_matrix <- cor(vars, use = "complete.obs")

# Print correlation with sale_price
cor_price <- cor_matrix["sale_price", ]

# Convert to data frame for kable
cor_price_df <- as.data.frame(t(cor_price))
colnames(cor_price_df) <- colnames(cor_matrix)  # Set column names
rownames(cor_price_df) <- "Correlation"

# Display with kable
kable(cor_price_df, 
      caption = "Correlation of Variables with Sale Price",
      col.names = colnames(cor_price_df),
      align = "c", 
      format = "markdown")
```





First, we will analyze House square footage, the variable with the highest correlation (=0.54) to 'sale_price'.
```{R, echo=FALSE}
# Summary statistics for square feet
sq_ft_summary <- housing %>%
group_by(sq_ft_thousand) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for House Square Feet
kable(sq_ft_summary, 
  col.names = c("House Square Feet (in thousands)", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "Summary Statistics for Sale Price by House Square Feet",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for square feet
ggplot(data = sq_ft_summary, aes(x=sq_ft_thousand, y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  ggtitle("Mean Sales Price by House Square Feet") +
  xlab("Square Feet (in thousands)") +
  ylab("Mean Sale Price ($USD)") +
  geom_text(aes(label=mean_sale_price), vjust=0.1, size=1.5, angle = 90) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of house square feet
ggplot(housing, aes(x = factor(sq_ft_thousand), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  ggtitle("Sale Price Distribution by Square Footage") +
  xlab("Square Feet (in thousands)") +
  ylab("Sale Price ($USD)") +
  scale_y_continuous(labels = scales::comma)

# Scatter plot with regression line for house square feet
ggscatter(housing, x = "house_square_feet", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  ggtitle("Sale Price Correlation with House Square Feet") +
  xlab("Square Feet") +
  ylab("Sale Price ($USD)") +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```





Next, we will view the association between the time the house was built and Sale Price.

```{R, echo=FALSE}
# Summary statistics for Year Built
year_built_summary <- housing %>%
group_by(decade_built) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Decade built
kable(year_built_summary, 
  col.names = c("Decade Built", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "Summary Statistics for Sale Price by Decade Built",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for decade built
ggplot(data = year_built_summary, aes(x=factor(decade_built), y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  ggtitle("Mean Sales Price by Decade Built") +
  xlab("Decade Built") +
  ylab("Mean Sale Price ($USD)") +
  geom_text(aes(label=mean_sale_price), vjust=0.1, size=2.5, angle = 90) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of decade built
ggplot(housing, aes(x = factor(decade_built), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  ggtitle("Sale Price Distribution by Decade Built") +
  xlab("Decade Built") +
  ylab("Sale Price ($USD)") +
  scale_y_continuous(labels = scales::comma)

# Scatter plot with regression line for year built
ggscatter(housing, x = "year_built", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  ggtitle("Sale Price Correlation with Year Built") +
  xlab("Year Built") +
  ylab("Sale Price ($USD)") +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```




Lastly, we will view the association between Number of Bedrooms and Sale Price.

Let us find the summary statistics for Bedrooms in relation to Sale Price.
```{R, echo = FALSE}
# Summary statistics for Bedrooms
bedroom_summary <- housing %>%
group_by(bedrooms) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Bedrooms
kable(bedroom_summary, 
  col.names = c("Bedrooms", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "Summary Statistics for Sale Price by Number of Bedrooms",
  align = "c")

```


```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for bedrooms
ggplot(data = bedroom_summary, aes(x=factor(bedrooms), y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  ggtitle("Mean Sale Price by Number of Rooms") +
  xlab("Number of Bedrooms") +
  ylab("Mean Sale Price ($USD)") +
  geom_text(aes(label=mean_sale_price), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)

# Plot distribution of bedrooms
ggplot(housing, aes(x = factor(bedrooms), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  ggtitle("Sale Price Distribution by Number of Rooms") +
  xlab("Number of Bedrooms") +
  ylab("Sale Price ($USD)") +
  scale_y_continuous(labels = scales::comma)

# scatter plot for number of bedrooms with regression line
ggscatter(data = housing, x = "bedrooms", y = "sale_price",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") +
  ggtitle("Sale Price Correlation with Number of Bedrooms") +
  xlab("Number of Bedrooms") +
  ylab("Sale Price ($USD)") +
  geom_smooth(method=lm,se=FALSE,fullrange=TRUE) +
  scale_y_continuous(labels = scales::comma)

```









Part 2: Is missingness informative? Create a binary variable that indicates whether
the view quality is missing. Missing values in this data file are represented as an empty
character string; that is, `'. Choose three variables. (They may, but do not need to be, the
same variables from part 1.) Explore the association between these variables and the binary
variable that you created. Follow the same instructions as in Part 1.

```{R, echo=FALSE}
# Select columns for correlation analysis
vars <- housing %>% select(has_view_quality, sale_price, sq_ft_thousand, house_square_feet, bedrooms)

# Calculate correlation matrix
cor_matrix <- cor(vars, use = "complete.obs")

# Print correlation with has_view_quality
cor_view <- cor_matrix["has_view_quality", ]

# Convert to data frame for kable
cor_view_df <- as.data.frame(t(cor_view))
colnames(cor_view_df) <- colnames(cor_matrix)  # Set column names
rownames(cor_view_df) <- "Correlation"

# Display with kable
kable(cor_view_df, 
      caption = "Correlation of Variables with data for View Quality",
      col.names = colnames(cor_view_df),
      align = "c", 
      format = "markdown")
```





First, we will analyze 'sale_price', the variable with the highest correlation (=0.25) to 'has_view_quality'.
```{R, echo=FALSE}
# Summary statistics for sale_price
price_view_summary <- housing %>%
group_by(has_view_quality) %>%
summarize(
  count = n(),
  mean_sale_price = as.integer(mean(sale_price, na.rm = TRUE)),
  median_sale_price = as.integer(median(sale_price, na.rm = TRUE)),
  sd_sale_price = as.integer(sd(sale_price, na.rm = TRUE)),
  min_sale_price = min(sale_price, na.rm = TRUE),
  max_sale_price = max(sale_price, na.rm = TRUE)
)

# Display the summary statistics in a table format for Bedrooms
kable(price_view_summary, 
  col.names = c("Has View Quality", "Count", "Mean Sale Price", "Median Sale Price", 
                "SD of Sale Price", "Min Sale Price", "Max Sale Price"),
  caption = "Summary Statistics for Has View Quality by Sale Price",
  align = "c")


```

```{R, echo=FALSE, message=FALSE}

# Bar chart for mean sale price for has_view_quality
ggplot(data = price_view_summary, aes(x=factor(has_view_quality), y=mean_sale_price)) +
  geom_bar(stat = "identity", fill="steelblue") +
  ggtitle("Mean Sale Price by presence of View Quality description") +
  xlab("Has View Quality (0=no, 1=yes)") +
  ylab("Mean Sale Price ($USD)") +
  geom_text(aes(label=mean_sale_price), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)


# Plot distribution of sale_price
ggplot(housing, aes(x = factor(has_view_quality), y = sale_price)) +
  geom_boxplot(fill = "green", color = "black") +
  ggtitle("Sale Price Distribution by presence of View Quality description") +
  xlab("Has View Quality (0=no, 1=yes)") +
  ylab("Sale Price ($USD)") +
  scale_y_continuous(labels = scales::comma)

```






Analyzing association between House square footage and presence of view quality description.
```{R, echo=FALSE}
# Summary statistics for house_square_feet
sqft_view_summary <- housing %>%
group_by(has_view_quality) %>%
summarize(
  count = n(),
  mean_sqft = as.integer(mean(house_square_feet, na.rm = TRUE)),
  median_sqft = as.integer(median(house_square_feet, na.rm = TRUE)),
  sd_sqft = as.integer(sd(house_square_feet, na.rm = TRUE)),
  min_sqft = min(house_square_feet, na.rm = TRUE),
  max_sqft = max(house_square_feet, na.rm = TRUE)
)

# Display the summary statistics in a table format for house square footage
kable(price_view_summary, 
  col.names = c("Has View Quality", "Count", "Mean Square Feet", "Median Square Feet", 
                "SD of Square Feet", "Min Square Feet", "Max Square Feet"),
  caption = "Summary Statistics for Has View Quality by Square Feet",
  align = "c")


```


```{R, echo=FALSE, message=FALSE}

# Bar chart for mean house_square_feet for has_view_quality
ggplot(data = sqft_view_summary, aes(x=factor(has_view_quality), y=mean_sqft)) +
  geom_bar(stat = "identity", fill="steelblue") +
  ggtitle("Mean Square Footage by presence of View Quality description") +
  xlab("Has View Quality (0=no, 1=yes)") +
  ylab("Mean House Square Feet (sqft)") +
  geom_text(aes(label=mean_sqft), vjust=1, size=3.5) +
  scale_y_continuous(labels = scales::comma)


# Plot distribution of house_square_feet
ggplot(housing, aes(x = factor(has_view_quality), y = house_square_feet)) +
  geom_boxplot(fill = "green", color = "black") +
  ggtitle("Square Footage Distribution by presence of View Quality description") +
  xlab("Has View Quality (0=no, 1=yes)") +
  ylab("House Square Feet (sqft)") +
  scale_y_continuous(labels = scales::comma)

```
